import{readFileSync as $}from"fs";import{resolve as N}from"path";import{DIRECTORY_NAME as a,INJECT_SCRIPT_FILE_NAME as d,INJECT_STYLE_FILE_NAME as p,JSON_FILE_NAME as F,NOTIFICATION_ANCHOR_CLASS_NAME as E,generateJSONFileContent as S,generateJsFileContent as j,getFileHash as v,getVersion as _,get__Dirname as y}from"@plugin-web-update-notification/core";async function A(){return await import("vite").then(({version:t})=>t)}function C(t,l,f,{cssFileHash:o,jsFileHash:g}){let{customNotificationHTML:m,hiddenDefaultNotification:e,injectFileBase:n=""}=f,r=`<script>window.pluginWebUpdateNotice_version = '${l}';</script>`,u=m||e?"":`<link rel="stylesheet" href="${n}${a}/${p}.${o}.css">`,i=t;return i=i.replace("<head>",`<head>
    ${u}
    <script src="${n}${a}/${d}.${g}.js"></script>
    ${r}`),e||(i=i.replace("</body>",`<div class="${E}"></div></body>`)),i}function O(t={}){let l,f,{versionType:o,customVersion:g,silence:m}=t,e="";o==="custom"?e=_(o,g):e=_(o);let n="",r="",u=$(`${N(y(),p)}.css`,"utf8").toString();r=v(u);let i="";return{name:"vue-vite-web-update-notice",apply:"build",enforce:"post",async configResolved(s){l=s,t.injectFileBase===void 0&&(t.injectFileBase=l.base),i=j($(`${N(y(),d)}.js`,"utf8").toString(),e,t),n=v(i),f=await A()},generateBundle(s,c={}){e&&(c[F]={isAsset:!0,type:"asset",name:void 0,source:S(e,m),fileName:`${a}/${F}.json`},c[p]={isAsset:!0,type:"asset",name:void 0,source:u,fileName:`${a}/${p}.${r}.css`},c[d]={isAsset:!0,type:"asset",name:void 0,source:i,fileName:`${a}/${d}.${n}.js`})},transformIndexHtml:f===void 0?{enforce:"post",async transform(s){return e?C(s,e,t,{jsFileHash:n,cssFileHash:r}):s}}:{order:"post",handler(s,{chunk:c}){return e&&c?C(s,e,t,{jsFileHash:n,cssFileHash:r}):s}}}}export{O as webUpdateNotice};
//# sourceMappingURL=index.js.map